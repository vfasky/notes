define("note/api",["jquery","catke"],function(t,e){"use strict";var n=e.http,i="/api/v1/",o={getBook:function(t){return n.get(i+"book",{id:t||""})},getNote:function(t){return n.get(i+"note",t||{})}};return o}),define("note/app",["jquery","note/route","catke"],function(t,e,n){"use strict";var i=n.popTips,o=n.Loading,r=n.classExt,s=new o({tip:"加载中 ... "}),u=function(e,n){this._route={},this._view=null,this.addEvent("viewBeforeShow"),this.addEvent("viewAfterShow"),this.$el=e,this.config=t.extend({viewClass:"app-view",Template:null},n||{}),this.loading=s,this.popTips=i};return u.prototype=r.extendProto(r.ClassEvent.prototype),u.prototype.callView=function(e,n,i){var o,r=this;this.callEvent("viewBeforeShow",e),i=i||function(){};var s=function(t){i(),r.callEvent("viewAfterShow",t)};if(null!==r._view){if(r._view.name===e)return r._view.instance.run(n),void s(r._view.instance);var u=r._view.instance;u.destroy()}r.loading.show();var a=function(i){r.loading.hide(),o=t('<div class="'+r.config.viewClass+'"></div>');var u=new i(o,r);u.run(n),r._view={name:e,instance:u},u.$el.appendTo(r.$el),s(r._view.instance)};if("string"==typeof e){var l=window.requirejs||window.require;l([e],function(t){a(t)})}else a(e)},u.prototype.route=function(t,e,n){return void 0===n&&(n=e,e={}),this._route[t]=[e,n],this},u.prototype.url=function(e){e=t.trim(e);for(var n in this._route){var i=this._route[n];if(e===i[1])return n}},u.prototype.run=function(){var t=this,n=new e,i=function(e){var i=t._route[e];n.map(e,i[0],function(e){t.callView(i[1],e||{})})};for(var o in t._route)i(o);n.init()},u}),define("note/book",["note/view","note/api"],function(t,e){"use strict";return t.extend({initialize:function(t,e){this.superclass.initialize.call(this,t,e)},run:function(t){this.superclass.run.call(this,t),this.when(this.initAnt("note/book.html"),e.getBook()).done(function(t,e){t.render({books:e.books})})}})}),define("note/bookView",["note/view","note/api","jquery","catke"],function(t,e){"use strict";return t.extend({initialize:function(t,e){this.superclass.initialize.call(this,t,e)},run:function(t){this.superclass.run.call(this,t);var n=this;return!1===this.validator.isMongoId(this.context.id)?this.error("参数异常"):void this.when(this.initAnt("note/bookView.html"),e.getBook(this.context.id),e.getNote({bookId:this.context.id})).done(function(t,e,i){var o=e.book,r=i.notes;return null===o?n.error("抱歉，没找到相关笔记本"):void console.log(o,r)})}})}),define("note/main",["note/app"],function(t){"use strict";return function(e){var n=new t(e);n.route("/","note/book").route("/book","note/bookView").run()}}),define("note/route",["jquery"],function(t){"use strict";var e=function(){this._routes=[]};return e.prototype.init=function(){var e=this;t(window).on("hashchange",function(){e.listener.apply(e,arguments)}),this.listener()},e.prototype.listener=function(){var e,n=location.hash.slice(1).split("?"),i=n[0];n[1]&&(e=this.getUrlParams(n[1]));var o,r=this.getRoute(i),s={};if(!r)return void location.replace("#/");o=this.getValues(i,r);for(var u=0;u<r.params.length;u++)s[r.params[u]]=o[u];e=t.extend({},s,e),r.handle(e)},e.prototype.getUrlParams=function(t){var e={};if(!t)return e;for(var n,i=t.split("&"),o=0;o<i.length;o++)n=i[o].split("="),e[n[0]]=n[1];return e},e.prototype.map=function(t,e,n){var i,o,r,s=[];if(o=t.replace(/\//g,"\\/"),"function"==typeof e&&(n=e,e=null),e)for(var u in e)i=new RegExp("\\{"+u+"\\}","g"),o=o.replace(i,"("+e[u].replace(/\^/,"").replace(/\$/,"")+")"),s.push(u);for(i=new RegExp("{([^}]+)}","g");null!==(r=i.exec(o));)s.push(r[1]),i.lastIndex;return o="^"+o.replace(/{[^}]+}/gi,"(.+)")+"$",this._routes.push({routeUrl:t,pattern:o,params:s,handle:n||function(){}}),this},e.prototype.getValues=function(t,e){var e,n=[];if(0===t.length)return n;if(e=e||this.getRoute(t),null!==e){var i=t.match(e.pattern);if(0!==i.length)for(var o=1;o<i.length;o++)n.push(i[o])}return n},e.prototype.getRoute=function(t){for(var e=0;e<this._routes.length;e++)if(new RegExp(this._routes[e].pattern).test(t))return this._routes[e];return null},e}),define("note/template",["ant","jquery"],function(t,e){"use strict";var n;return n=function(i,o){return o=e.extend({filters:n.filters},o||{}),new t(i,o)},n.filters={String:String,Number:Number},n.load=function(t){var n=e.Deferred(),i=t.split("/");return 2!==i.length||-1===i[1].indexOf(".html")?n.reject("tpl uri error : "+t):require(["tpl/"+i[0]],function(t){n.resolve(t[i[1]])}),n.promise()},n}),define("note/view",["jquery","catke","note/template","validator"],function(t,e,n,i){"use strict";var o=e.http,r=e.classExt,s=function(t,e){this.$el=t,this.app=e,this.template=n,this.http=o,this.validator=i};return s.prototype.when=function(){return t.when.apply(this,arguments)},s.prototype.run=function(t){this.context=t},s.prototype.destroy=function(){this.$el.remove()},s.prototype.initAnt=function(e,n){var i=t.Deferred(),o=this;return this.ant?i.resolve(this.ant):this.template.load(e).done(function(t){o.$el.html(t),o.ant=o.template(o.$el,n||{}),i.resolve(o.ant)}),i.promise()},s.prototype.error=function(t){e.popTips.error(t||"发生未知错误",function(){0===window.history.length?window.location.href="#/":window.history.back()},3e3)},s.extend=function(t){return r.extend(s,t)},s}),define("note",["note/api","note/app","note/book","note/bookView","note/main","note/route","note/template","note/view"],function(t,e,n,i,o,r,s,u){return{Api:t,App:e,Book:n,BookView:i,main:o,Route:r,Template:s,View:u}});